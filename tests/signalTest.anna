def main()
{
    use(unix.proc);

    /*
      Perform some testing for the SignalSet type
     */
    ss := SignalSet();
    print(?, signal.int in ss);
    print(?, signal.sys in ss);

    ss.add(signal.int);
    print(1, signal.int in ss);
    print(?, signal.sys in ss);

    print(1, ss[signal.int]);
    print(?, ss[signal.sys]);

    ss[signal.sys] = 1;
    print(1, ss[signal.int]);
    print(1, ss[signal.sys]);

    ss[signal.sys] = ?;
    print(1, ss[signal.int]);
    print(?, ss[signal.sys]);

    ss.remove(signal.int);
    print(?, signal.int in ss);
    print(?, signal.sys in ss);

    ss.all();
    print(1, signal.int in ss);
    print(1, signal.sys in ss);

    ss.clear();
    print(?, signal.int in ss);
    print(?, signal.sys in ss);

    /*
      Set up signal handling using the signalfd call
     */
    ss.all();
    signalFd := signalfd(-1, ss, 0);

    sigInfo := SignalInfoFd();
    sigprocmask(sigprocmaskFlag.block, ss, ?);

    /*
      Test that signals get delivered correctly
     */
    [signal.usr1, signal.hup, signal.fpe].each(sig)
    {
	kill(getpid(), sig);
	readSignal(signalFd, sigInfo);
	print("Ok?", sigInfo.signal == sig);
    }
    
    unix.io.close(signalFd);
}